<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FLARE ‚Äì PyPI Library Recommender</title>

<style>
:root {
  --bg: #111;               /* matte black background */
  --panel-bg: #1c1c1c;      /* dark grey panels */
  --accent: #ffffff;        /* white text / accent */
  --accent-muted: #e5e5e5;  /* muted white for secondary text */
  --link: #60a5fa;          /* light blue links for results */
  --radius: 10px;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Segoe UI", Roboto, sans-serif;
  background: var(--bg);
  color: var(--accent);
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  line-height: 1.45;
}

.auth-links span {
  margin-top: 7px;
}

/* Header */
header {
  background: #000;
  color: var(--accent);
  text-align: center;
  padding: 2rem 1rem;
}
header h1 {
  margin: 0;
  font-size: 2rem;
  font-weight: 600;
}
header p {
  margin-top: .3rem;
  font-size: 1rem;
  color: var(--accent-muted);
}

/* Main layout */
main {
  flex: 1;
  width: 100%;
  max-width: 1000px;
  margin: 2rem auto;
  padding: 0 1rem;
}

/* Cards */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px,1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}
.card {
  background: var(--panel-bg);
  padding: 1.8rem;
  border-radius: var(--radius);
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
}
.card h2 {
  margin: 0 0 .5rem;
  font-size: 1.25rem;
}
.card ul {
  padding-left: 1.2rem;
  list-style: none;
  margin: .3rem 0 0;
}
.card li {
  margin-bottom: .4rem;
  position: relative;
  padding-left: 1.4em;
}
.card li::before {
  content: "‚Ä¢";
  position: absolute;
  left: 0;
  color: var(--accent);
}

.search-result {
  margin-bottom: 1.2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #333;
}
.search-result h3 {
  margin: 0 0 .2rem;
  font-size: 1.05rem;
  line-height: 1.3;
}
.search-result h3 a {
  color: var(--link);
  text-decoration: none;
}
.search-result h3 a:hover { text-decoration: underline; }
.search-result .link {
  color: #9ca3af;
  font-size: 0.8rem;
  margin-bottom: 0.2rem;
}
.search-result .description {
  color: var(--accent-muted);
  font-size: 0.85rem;
  margin-bottom: 0.3rem;
}
.search-result .meta {
  color: #9ca3af;
  font-size: 0.75rem;
  margin-bottom: 0.4rem;
}
.actions {
  display: flex;
  gap: 0.5rem;
}
.action-btn {
  background: var(--accent);
  color: #000;
  padding: 0.3rem 0.6rem;
  border-radius: var(--radius);
  text-decoration: none;
  font-size: 0.8rem;
  font-weight: 600;
  transition: background .2s;
}
.action-btn:hover {
  background: var(--accent-muted);
}

/* Progress / error messages */
.progress-alert, .error-alert {
  background: var(--panel-bg);
  border: 1px solid #333;
  border-radius: var(--radius);
  padding: 0.8rem 1rem;
  color: var(--accent);
  font-size: 0.9rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 1rem 0;
}
.error-alert {
  border-left: 4px solid #e11d48;
  color: #fca5a5;
}

.progress-alert {
  border-left: 4px solid #1de148;
}
.progress-alert .percent {
  color: var(--link);
  font-weight: 600;
}

/* --- Auth Links --- */
.auth-links {
  position: absolute;
  top: 1.2rem;
  right: 1.5rem;
  display: flex;
  gap: 1rem;
  font-size: 0.9rem;
}
.auth-links a {
  color: var(--accent);
  text-decoration: none;
  padding: 0.3rem 0.6rem;
  border: 1px solid #333;
  border-radius: var(--radius);
  background: #000;
  transition: background .2s;
}
.auth-links a:hover {
  background: #333;
}


/* Form */
form {
  background: var(--panel-bg);
  padding: 1.8rem;
  border-radius: var(--radius);
  box-shadow: 0 3px 8px rgba(0,0,0,0.4);
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 2rem;
}
textarea, select {
  width: 100%;
  padding: .7rem 1rem;
  border: 1px solid #333;
  border-radius: var(--radius);
  background: #000;
  color: var(--accent);
  font-size: .95rem;
  resize: vertical;
}
button {
  padding: .8rem 1rem;
  font-size: 1rem;
  font-weight: 600;
  color: #000;
  background: var(--accent);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background .2s;
}
button:hover { background: var(--accent-muted); }

/* Progress + Cancel */
#progress-area {
  display: none;
  gap: 1rem;
  align-items: center;
}
.progress-bar {
  flex: 1;
  background: #333;
  border-radius: var(--radius);
  overflow: hidden;
  height: 1rem;
}
.progress-bar-inner {
  background: var(--accent);
  height: 100%;
  width: 0%;
  transition: width 0.3s ease;
}
#cancel-btn {
  background: #e11d48;
  color: #fff;
}
#cancel-btn:hover {
  background: #be123c;
}

/* Results ‚Äì compact */
#results { margin-top: 1rem; }
.search-result { margin-bottom: 1.2rem; }
.search-result h3 {
  margin: 0;
  font-size: 1.05rem;
  line-height: 1.3;
}
.search-result h3 a {
  color: var(--link);
  text-decoration: none;
}
.search-result h3 a:hover { text-decoration: underline; }
.search-result .link {
  color: #9ca3af;
  font-size: 0.8rem;
  margin: 0.1rem 0;
}
.search-result .description {
  color: var(--accent-muted);
  font-size: 0.85rem;
  margin-top: 0.1rem;
}

/* Footer */
footer {
  text-align: center;
  color: var(--accent-muted);
  font-size: .85rem;
  padding: 1rem 0 2rem;
}

.star { display: none; }
.logged-in .star { display: inline; cursor: pointer; color: #666; font-size: 1.5em; }
.logged-in .star.starred { color: gold; }

</style>
</head>

<body>

<header>
    <div class="auth-links" id="auth-links"></div>

  <h1>‚ö° FLARE</h1>
  <p>PyPI library recommendations from your project description</p>
</header>

<main>
  <!-- Search Form -->
  <form onsubmit="event.preventDefault(); search();">
    <textarea id="description" rows="3" placeholder="Describe your software or project‚Ä¶"></textarea>

    <select id="task">
      <option value="1" selected>Reuse</option>
      <option value="2">Build</option>
    </select>
      <select id="speed">
      <option value="0">Feeling lucky (if libraries are already indexed)</option>
      <option value="1">Quick run</option>
      <option value="2" selected>Improve index with relevant libraries first</option>
      <option value="3">Deeply explore and index related options</option>
    </select>

    <div id="controls">
      <button type="submit" id="search-btn">Recommend Libraries</button>
    </div>

    <!-- Progress + Cancel -->
    <div id="progress-area">
      <div class="progress-bar">
        <div class="progress-bar-inner" id="progress-bar-inner"></div>
      </div>
      <button type="button" id="cancel-btn">Cancel Search</button>
    </div>
  </form>

  <!-- Info cards -->
  <div class="cards" id="info-cards">
    <div class="card">
      <h2>üõ†Ô∏è Build vs Reuse</h2>
      <ul>
        <li>Reuse: find existing Python libraries to integrate into your project</li>
        <li>Build: discover libraries when you plan to implement the described software yourself</li>
      </ul>
    </div>

    <div class="card">
      <h2>üîé Keyword & dependency analysis</h2>
      <ul>
        <li>Expands queries with synonyms</li>
        <li>Examines dependencies between projects</li>
        <li>Emulates human exploration</li>
        <li>Recommends by relevance and context</li>
      </ul>
    </div>
  </div>

  <div id="results"></div>
</main>

<footer>
  &copy; 2025 FLARE. All rights reserved.
</footer>

<script>
let updating;
let currentId;

function status(res) {
  if (res.ok) return Promise.resolve(res);
  clearInterval(updating);
  return Promise.reject(new Error(res.statusText));
}

function update_search(identifier) {
  fetch("/status/" + identifier)
    .then(status)
    .then(res => res.json())
    .then(response => {
      document.getElementById("progress-bar-inner").style.width = response.progress + "%";

      if (response.progress === "100") {
        clearInterval(updating);
        showControls();
        const cards = document.getElementById("info-cards");
        document.getElementById("results").insertAdjacentElement("afterend", cards);
        cards.style.display = "grid";
      }
      document.getElementById("results").innerHTML = response.result;
    });
}

function search() {
  clearInterval(updating);
  hideControls();
  document.getElementById("info-cards").style.display = "none";
  document.getElementById("progress-bar-inner").style.width = "0%";

  fetch("/search", {
    method: "POST",
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      task: document.getElementById("task").value,
      speed: document.getElementById("speed").value,
      search: document.getElementById("description").value
    })
  })
  .then(status)
  .then(res => res.json())
  .then(response => {
    currentId = response.identifier;
    updating = setInterval(() => update_search(currentId), 500);
  });
}

function cancelSearch() {
  if (confirm("Cancel search? Any progress will be lost.")) {
    clearInterval(updating);
    showControls();
  }
}

function hideControls() {
  document.getElementById("controls").style.display = "none";
  document.getElementById("progress-area").style.display = "flex";
}

function showControls() {
  document.getElementById("controls").style.display = "block";
  document.getElementById("progress-area").style.display = "none";
}

function styleResults(rawHtml) {
  return rawHtml.replace(/accordion-item/g, 'search-result');
}

document.getElementById("cancel-btn").addEventListener("click", cancelSearch);
</script>

<script>
const authLinks = document.getElementById("auth-links");
if (window.FLARE_USER) {
  document.body.classList.add("logged-in");
  authLinks.innerHTML =
    `<span>üë§ ${window.FLARE_USER}</span>
     <a href="/logout">Logout</a>`;
  fetch("/stars")
    .then(r=>r.json())
    .then(list => {
      list.forEach(pkg => {
        const el = document.querySelector(`[data-pkg="${pkg}"] .star`);
        if (el) el.classList.add("starred");
      });
    });
} else {
  authLinks.innerHTML =
    `<a href="/register">Register</a>
     <a href="/login">Login</a>`;
}
function toggleStar(pkg) {
  const el = document.querySelector(`[data-pkg="${pkg}"] .star`);
  if (!el) return;
  const nowStarred = !el.classList.contains("starred"); // what it *will* become
  el.classList.toggle("starred");
  el.textContent = nowStarred ? "‚òÖ" : "‚òÜ";
  const endpoint = nowStarred ? "/star/" : "/unstar/";
  fetch(endpoint + pkg, { method: "POST" });
}
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    if (window.FLARE_LAST_SEARCH) {
        const id = window.FLARE_LAST_SEARCH;
        // Immediately show an empty progress container
        document.getElementById("results").innerHTML =
            '<div id="progress-container">Loading‚Ä¶</div>';

        function poll() {
            fetch(`/status/${id}`)
                .then(r => r.json())
                .then(data => {
                    // `data.result` is the HTML snippet for the progress bar or final results
                    document.getElementById("results").innerHTML = data.result;

                    // keep polling until finished
                    if (parseInt(data.progress, 10) < 100) {
                        setTimeout(poll, 2000);
                    }
                });
        }
        poll();
    }
});
</script>
<script>
const resultsDiv   = document.getElementById('results');
const cardsWrapper = document.getElementById('info-cards');

if (
    resultsDiv.querySelector('.result-card') ||
    resultsDiv.querySelector('.progress-alert')
) {
    cardsWrapper.style.display = 'none';
} else {
    cardsWrapper.style.display = 'block';
}
</script>



</body>
</html>
